<!DOCTYPE html>
<html lang="pt-BR" data-font="sans" style="--app-height: 100vh; --transition-duration: 0.35s;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Minhas Notas</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Minhas Notas">
    <link rel="apple-touch-icon" href="favicon.png">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Slab:wght@400;700&family=Source+Code+Pro:wght@400;600&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
     
    <link rel="stylesheet" href="style.css">
</head>
<body class="is-loading" data-theme="light" data-icon-theme="solid">
    
  <div id="login-screen" style="display: none;"> 
      <div class="login-box"> 
          <div class="icon"><i class="fas fa-lock" id="login-icon"></i></div> 
          <h1>Acesso Restrito</h1> 
          <p>Por favor, insira a senha para continuar.</p> 
          <input type="password" id="password-input" placeholder="••••••••"> 
          <div id="error-message" class="error-message"></div> 
          <button id="login-button" class="actions-button" onclick="handleLogin()">Entrar</button> 
      </div> 
  </div>

  <div id="security-check-screen" style="display: none;"> 
      <div class="login-box"> 
          <div class="icon"><i class="fas fa-shield-alt"></i></div> 
          <h1>Verificação de Segurança</h1> 
          <p>Por favor, digite sua senha atual para prosseguir.</p> 
          <input type="password" id="security-check-password-input" placeholder="••••••••"> 
          <div id="security-check-error-message" class="error-message"></div> 
          <div class="actions" style="grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 24px;"> 
              <button class="actions-button" style="background-color: var(--text-light);" onclick="cancelSecurityCheck()">Cancelar</button> 
              <button class="actions-button" style="background-color: var(--accent-color);" onclick="handleSecurityCheck()">Verificar</button> 
          </div> 
      </div> 
  </div>

  <div id="password-change-screen" style="display: none;"> 
      <div class="login-box"> 
          <div class="icon"><i class="fas fa-key"></i></div> 
          <h1>Alterar Senha</h1> 
          <p>Crie uma nova senha para sua conta.</p> 
          <input type="password" id="new-password-input" placeholder="Nova Senha"> 
          <input type="password" id="confirm-password-input" placeholder="Confirmar Senha" style="margin-top: 16px;"> 
          <div id="password-error-message" class="error-message"></div> 
          <div class="actions" style="grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 24px;"> 
              <button class="actions-button" style="background-color: var(--text-light);" onclick="closePasswordChangeScreen()">Cancelar</button> 
              <button class="actions-button" style="background-color: var(--accent-color);" onclick="handleSaveNewPassword()">Salvar</button> 
          </div> 
      </div> 
  </div>
    
  <div class="app-container" id="app-container" style="display: flex;">
    
    <nav class="sidebar"> 
        <div class="sidebar-header">Minhas Notas</div> 
        <ul id="sidebar-nav" class="sidebar-nav"></ul> 
    </nav>
    
    <div class="main-content">
        <header class="header">
            <h1 id="main-header-title" class="header-title">Anotações</h1>
            <div class="header-actions">
                <button class="header-action" id="sync-btn" onclick="sincronizarManualmente(this)" style="display: flex;">
                    <span class="icon-wrapper">
                        <i class="fa-solid fa-sync-alt"></i><span class="material-icons">sync</span>
                    </span>
                </button>
                <button class="header-action" id="close-btn" style="display: none;">
                    <span class="icon-wrapper">
                        <i class="fa-solid fa-times"></i><span class="material-icons">close</span>
                    </span>
                </button>
            </div>
        </header>

        <div class="screen-wrapper">
            
            <div class="app-screen" id="screen-add">
                <div class="card">
                    <div class="campo"><label for="data">Data</label><input type="text" id="data" class="form-field" placeholder="dd/mm/aaaa" inputmode="decimal" oninput="formatarDataInput(this)"></div>
                    <div class="campo"><label for="nf">NF</label><input type="text" id="nf" class="form-field" placeholder="Número da Nota Fiscal" inputmode="numeric"></div>
                    <div class="campo"><label for="venc">Vencimento</label><input type="text" id="venc" class="form-field" placeholder="dd/mm/aaaa" inputmode="decimal" oninput="formatarDataInput(this)"></div>
                    <div class="campo"><label for="valor">Valor Total</label><input id="valor" type="text" class="form-field" placeholder="Ex: 1200,50" inputmode="decimal" onblur="formatarValorBlur(event)"></div>
                    <div class="campo"><label for="forn">Nome do Fornecedor</label><input type="text" id="forn" class="form-field" placeholder="Nome do fornecedor" list="fornecedores-sugeridos" value=""><datalist id="fornecedores-sugeridos"></datalist></div>
                    <div class="campo"><label for="obs">Observações</label><select id="obs" class="form-field"><option value="">Recurso a ser pago</option></select></div>
                    
                    <div class="actions">
                        <button id="salvarBtn" class="actions-button" style="background-color: var(--button-success);" onclick="salvarNota()">
                            <span class="icon-wrapper"><i class="fa-solid fa-save"></i><span class="material-icons">save</span></span> Salvar
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="app-screen" id="screen-manage"> 
                <div id="lista-notas-pendentes" class="nota-list"></div> 
            </div>
            
            <div class="app-screen" id="screen-export">
                <div id="export-info-bar" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; font-weight: 600; color: var(--text-light); font-size: 14px;">
                     <span>Contabilização:</span>
                     <span style="background: var(--bg-secondary); padding: 4px 10px; border-radius: 8px; border: 1px solid var(--border-color); color: var(--text-dark);"><span id="total-notas-export">0</span> notas</span>
                </div>

                <textarea id="saida" readonly="" placeholder="O texto das notas pendentes aparecerá aqui..."></textarea>
                <div class="actions">
                    <button class="actions-button" style="background-color: var(--accent-color);" onclick="ordenarExportacao()"><span class="icon-wrapper"><i class="fa-solid fa-sort-alpha-down"></i><span class="material-icons">sort_by_alpha</span></span> Ordenar por Recurso</button>
                    <button class="actions-button" style="background-color: var(--accent-color);" onclick="exportar()"><span class="icon-wrapper"><i class="fa-solid fa-copy"></i><span class="material-icons">content_copy</span></span> Copiar</button>
                    <button class="actions-button" style="background-color: var(--button-whatsapp);" onclick="compartilharLista()"><span class="icon-wrapper"><i class="fab fa-whatsapp"></i><span class="material-icons">share</span></span> Compartilhar</button>
                    <button class="actions-button" style="background-color: var(--text-light);" onclick="limpar()"><span class="icon-wrapper"><i class="fa-solid fa-archive"></i><span class="material-icons">archive</span></span> Arquivar Tudo</button>
                </div>
            </div>

            <div class="app-screen" id="screen-reports">
                <div class="card" style="margin-bottom: 16px; background-color: color-mix(in srgb, var(--accent-color) 10%, transparent); border-color: var(--accent-color);">
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <i class="fa-solid fa-calendar-week" style="font-size: 24px; color: var(--accent-color);"></i>
                        <div>
                            <h3 style="margin: 0; font-size: 16px; color: var(--text-dark);">Próximos Vencimentos</h3>
                            <p style="margin: 4px 0 0; font-size: 13px; opacity: 0.8;">Notas vencendo nos próximos 7 dias.</p>
                        </div>
                    </div>
                </div>
                <div id="lista-relatorios" class="nota-list">
                     <div class="empty-state">Nenhuma nota próxima do vencimento.</div>
                </div>
            </div>

            <div class="app-screen" id="screen-history">
                <div id="lista-historico" class="nota-list"><div class="empty-state">O histórico está vazio.</div></div>
                <div id="historico-actions" class="actions" style="display: none; margin-top: 24px;"><button class="actions-button" style="background-color: var(--button-danger);" onclick="limparHistorico()"><span class="icon-wrapper"><i class="fa-solid fa-trash"></i><span class="material-icons">delete_sweep</span></span> Limpar Histórico</button></div>
            </div>

            <div class="app-screen" id="screen-settings">
                <ul class="settings-list-group">
                    <li><a data-screen="screen-fornecedores" data-title="Fornecedores"><i class="icon fa-solid fa-truck" style="background-color: #f5a623;"></i> Fornecedores <i class="fa-solid fa-chevron-right"></i></a></li>
                    <li><a data-screen="screen-pedidos" data-title="Pedidos e Recursos"><i class="icon fa-solid fa-box" style="background-color: #bd10e0;"></i> Pedidos e Recursos <i class="fa-solid fa-chevron-right"></i></a></li>
                    <li><a data-screen="screen-observacoes" data-title="Observações"><i class="icon fa-solid fa-comment-dots" style="background-color: #50e3c2;"></i> Observações <i class="fa-solid fa-chevron-right"></i></a></li>
                </ul>
                <ul class="settings-list-group">
                    <li><a data-screen="screen-personalizacao" data-title="Personalização"><i class="icon fa-solid fa-palette" style="background-color: #ff3b30;"></i> Personalização <i class="fa-solid fa-chevron-right"></i></a></li>
                    <li><a onclick="abrirModalSenhaComVerificacao()"><i class="icon fa-solid fa-key" style="background-color: #4cd964;"></i> Senha e Login <i class="fa-solid fa-chevron-right"></i></a></li>
                </ul>
            </div>
            
            <div class="app-screen" id="screen-fornecedores">
                <div class="card">
                    <div class="modal-campo"><label>Nome do Fornecedor</label><input type="text" id="forn-manage" placeholder="Digite para adicionar..."></div>
                    <button class="actions-button" style="background: var(--accent-color);" onclick="adicionarFornecedorManage()"><span class="icon-wrapper"><i class="fa-solid fa-plus"></i><span class="material-icons">add</span></span> Adicionar Fornecedor</button>
                    <ul id="lista-fornecedores-manage" class="manage-list"></ul>
                </div>
            </div>
            <div class="app-screen" id="screen-pedidos">
                <div class="card">
                    <div class="modal-campo"><label>Nº do Pedido</label><input type="text" id="pedido-num" placeholder="Digite o número do pedido"></div>
                    <div class="modal-campo"><label>Recurso</label><select id="pedido-recurso"><option value="">Selecione...</option><option value="Santa Casa">Santa Casa</option><option value="CTI">CTI</option></select></div>
                    <button class="actions-button" style="background: var(--accent-color); margin-top: 8px;" onclick="adicionarPedido()"><span class="icon-wrapper"><i class="fa-solid fa-plus"></i><span class="material-icons">add</span></span> Adicionar</button>
                    <ul id="lista-pedidos" class="manage-list"></ul>
                </div>
            </div>
            <div class="app-screen" id="screen-observacoes">
                <div class="card">
                     <div class="modal-campo"><label>Nova Observação</label><input type="text" id="obs-manage" placeholder="Ex: C/C UPA"></div>
                     <button class="actions-button" style="background: var(--accent-color);" onclick="adicionarObservacaoManage()"><span class="icon-wrapper"><i class="fa-solid fa-plus"></i><span class="material-icons">add</span></span> Adicionar Observação</button>
                     <ul id="lista-observacoes-manage" class="manage-list"></ul>
                </div>
            </div>
            <div class="app-screen" id="screen-personalizacao">
                <div class="card">
                    <div class="campo"> <label for="theme-select">Tema do Aplicativo</label> <select id="theme-select"> <option value="light">Claro</option> <option value="dark">Escuro</option> <option value="ocean">Oceano</option> <option value="sunset">Pôr do Sol</option> <option value="forest">Floresta</option> <option value="plum">Ameixa</option> <option value="wine">Vinho</option> </select> </div>
                    <div class="campo"> <label for="icon-theme-select">Estilo dos Ícones</label> <select id="icon-theme-select"> <option value="solid">Sólido (Padrão)</option> <option value="material">Material (Google)</option> <option value="outline">Contorno (Leve)</option> <option value="duotone">Duplo Tom</option> </select> </div>
                    <div class="campo"> <label for="font-select">Fonte do Aplicativo</label> <select id="font-select"> <option value="sans">Padrão (Inter)</option> <option value="serif">Serif (Roboto Slab)</option> <option value="mono">Mono (Source Code)</option> <option value="montserrat">Montserrat</option> </select> </div>
                    <div class="campo"> <label id="animation-speed-label" for="animation-speed-slider"> <span>Velocidade das Animações</span> <span id="animation-speed-value">Normal</span> </label> <input type="range" id="animation-speed-slider" min="0" max="3" step="1" value="2"> </div>
                    <div class="campo"> <label>Ordem dos Menus</label> <div id="menu-reorder-list" class="reorder-list"></div> </div>
                </div>
            </div>
            
            <div class="app-screen active" id="screen-anotacoes" style="">
                <textarea id="anotacoes-textarea" placeholder="Digite suas anotações aqui..."></textarea>
                <div class="anotacoes-actions">
                    <button id="anotacoes-salvar-btn" class="actions-button" style="background-color: var(--button-success);" onclick="salvarAnotacoesManual()"><span class="icon-wrapper"><i class="fa-solid fa-save"></i><span class="material-icons">save</span></span> Salvar</button>
                    <button id="anotacoes-colar-btn" class="actions-button" style="background-color: var(--text-light);" onclick="colarAnotacoes()"><span class="icon-wrapper"><i class="fa-solid fa-paste"></i><span class="material-icons">content_paste</span></span> Colar</button>
                    <button id="anotacoes-copiar-btn" class="actions-button" style="background-color: var(--accent-color);" onclick="copiarAnotacoes()"><span class="icon-wrapper"><i class="fa-solid fa-copy"></i><span class="material-icons">content_copy</span></span> Copiar</button>
                    <button class="actions-button" style="background-color: var(--button-danger);" onclick="limparAnotacoes()"><span class="icon-wrapper"><i class="fa-solid fa-trash"></i><span class="material-icons">delete</span></span> Limpar</button>
                </div>
            </div>
        </div>
    </div>
    
    <nav id="tab-bar" class="tab-bar"></nav>
  </div>
  
  <div id="confirm-modal" class="modal-screen"> 
      <div class="modal-content"> 
          <h2 id="confirm-title"></h2> 
          <p id="confirm-message"></p> 
          <div class="confirm-actions"> 
              <button id="cancel-btn" class="actions-button" style="background-color: var(--text-light);">Cancelar</button> 
              <button id="confirm-btn" class="actions-button">Confirmar</button> 
          </div> 
      </div> 
  </div>
  
  <div id="toast" class="toast" style="display: none;">✓ Nota salva com sucesso!</div>
      
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  
  <script src="script.js"></script>

</body>
</html>